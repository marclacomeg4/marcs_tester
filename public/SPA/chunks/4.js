(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{Fq0J:function(t,e,n){"use strict";n.r(e);var a=n("L2JU");function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var s={name:"campaign-schedules-chip",template:"campaign-schedules-chip",props:{display_text:{required:!0},campaign_uid:{required:!1}},data:function(){return{show_menu:!1,campaign_schedules:null}},methods:{openMenu:function(){this.show_menu=!0,this.getCampaignSchedules()},getCampaignSchedules:function(){var t=this,e={fields:["marketingCampaignSchedules{uid,action_type,meta}"],params:{first:100},endpoint:"marketing_campaign",relations:{}};e.params={uid:this.campaign_uid},e.order_by=[{field:"CREATED_AT",order:"ASC"}];var n={endpoint:e.endpoint,fields:e.fields,relations:e.relations,params:e.params};this.$graph.getEndPointQuery(n).then((function(e){console.log("get Campaign Schedules:",e),t.campaign_schedules=_.cloneDeep(e.marketingCampaignSchedules).sort((function(t,e){return t.meta.before_after_target===e.meta.before_after_target?"after"===t.meta.before_after_target?parseInt(t.meta.days_from_target,10)<parseInt(e.meta.days_from_target,10)?-1:1:parseInt(t.meta.days_from_target,10)>parseInt(e.meta.days_from_target,10)?-1:1:("on"===t.meta.before_after_target?"at":t.meta.before_after_target)<("on"===e.meta.before_after_target?"at":e.meta.before_after_target)?1:-1}))})).catch((function(t){console.log("GET campaign schedules ERROR:",t)})).finally((function(){}))},getTemplateForBrand:function(t,e){var n=e.find((function(e){return e.brand===t}));return n?n.slug:""}},computed:r(r({},Object(a.b)("email",["brands"])),{},{columns:function(){return["Days","","Date","Action","Subject","SMS"]}})},c=n("KHd+"),l=Object(c.a)(s,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-menu",{attrs:{"offset-x":"",right:"","min-width":550},scopedSlots:t._u([{key:"activator",fn:function(e){e.on,e.attrs;return[n("v-chip",{attrs:{small:"",dark:""},on:{click:t.openMenu}},[t._v("\n            "+t._s(t.display_text)+"\n        ")])]}}]),model:{value:t.show_menu,callback:function(e){t.show_menu=e},expression:"show_menu"}},[t._v(" "),n("v-card",[n("v-card-text",{staticClass:"py-0"},[t.campaign_schedules?n("v-row",[n("v-col",[t.campaign_schedules.length>0?n("v-simple-table",{scopedSlots:t._u([{key:"default",fn:function(){return[n("thead",[n("tr",[t._l(t.columns,(function(e){return[n("td",[t._v(t._s(e))])]})),t._v(" "),t._l(t.brands,(function(t){return[n("td",[n("brand-fab",{attrs:{brand_prefix:t.brand}})],1)]}))],2)]),t._v(" "),n("tbody",t._l(t.campaign_schedules,(function(e,a){return n("tr",{key:a},[n("td",[t._v(t._s(e.meta.days_from_target))]),t._v(" "),n("td",[t._v(t._s(e.meta.before_after_target))]),t._v(" "),n("td",[t._v(t._s(e.meta.target_date))]),t._v(" "),n("td",[t._v(t._s(e.action_type))]),t._v(" "),n("td",[t._v(t._s(e.meta.email_subject))]),t._v(" "),n("td",[t._v(t._s(e.meta.sms))]),t._v(" "),t._l(t.brands,(function(a){return"Email"===e.action_type?[n("td",[t._v(t._s(t.getTemplateForBrand(a.brand,e.meta.template)))])]:t._e()}))],2)})),0)]},proxy:!0}],null,!1,2481050173)}):n("h4",[t._v("No Schedules Found")])],1)],1):n("page-loader")],1)],1)],1)}),[],!1,null,"41b9142e",null).exports;n("0xbr");function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){m(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function m(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var g={name:"CampaignList",components:{CampaignSchedulesChip:l,CampaignSelector:n("a2bP").a},data:function(){return{loading:!1,downloading:!1,marketing_campaigns:null,server_total_rows:null,options:{itemsPerPage:5,page:1,sortBy:[]},download_setup:{filename:"Marketing Campaigns",columns:[{text:"name",value:"meta.campaign_name"},{text:"schedules",value:"marketing_campaign_schedules_count"},{text:"status",value:"status"}]},columns:[{text:"name",value:"meta.campaign_name"},{text:"schedules",value:"marketingCampaignSchedules"},{text:"status",value:"status"},{text:"",value:"uid",sortable:!1}],pagination_options:{},campaign_selector:{campaign_uid:null}}},methods:{selectOptions:function(t){this.options.page=t.page,this.options.G4OrderBy=t.sortBy.length>0,this.options.G4OrderBy&&(this.options.field=t.sortBy[0],this.options.order=t.sortDesc[0]?"DESC":"ASC"),this.pagination_options.page=t.page,this.getMarketingCampaigns()},getRequest:function(){var t={endpoint:"marketing_campaign_search",fields:["meta","brands","uid","status","marketing_campaign_schedules_count"]};return t.params=p(p({},this.searchParams),this.pagination_options),t.paginate={first:this.options.itemsPerPage,page:this.options.page},t},getMarketingCampaigns:function(){var t=this;this.loading=!0;var e=this.getRequest();graph.getEndPointQuery(e).then((function(e){console.log("Get marketing campaigns:",e),t.marketing_campaigns=e.data,t.server_total_rows=e.paginatorInfo.total})).catch((function(t){console.log("GET marketing_campaign_search ERROR:",t)})).finally((function(){t.loading=!1}))},download:function(t){var e=this;this.downloading=!0,null===this.download_setup.columns&&(this.download_setup.columns=this.columns),this.$graph.download(this.getRequest(),this.download_setup).then((function(t){console.log("DOWNLOAD",t)})).finally((function(){e.downloading=!1}))},toggle_campaign_status:function(t){var e=this,n={campaign_uid:t.uid,status:"active"===t.status?"suspended":"active"};axios.post("/marketing-api/toggle-campaign-status",n).then((function(t){e.getMarketingCampaigns()})).catch((function(t){console.log(t)}))},edit_campaign_schedules:function(t){this.$router.push({name:"AddCampaignSchedules",params:{campaign_uid:t.uid}})},getBrands:function(t){console.log(JSON.stringify(t))}},computed:{searchParams:function(){return _.cloneDeep(this.campaign_selector)}},watch:{options:{handler:function(){this.options.sortBy.length>0&&(this.pagination_options.G4OrderBy=!0,this.pagination_options.field=this.options.sortBy[0],this.pagination_options.order=this.options.sortDesc[0]?"DESC":"ASC"),this.getMarketingCampaigns()}},deep:!0},created:function(){this.getMarketingCampaigns()}},d=Object(c.a)(g,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-row",[n("v-col",[n("v-row",[n("v-col",{staticClass:"pt-0"},[n("v-toolbar",{attrs:{dark:"",dense:"",color:"primary"}},[n("v-toolbar-title",[t._v("\n                        Campaign List\n                    ")]),t._v(" "),n("DemoDisplay")],1)],1)],1),t._v(" "),n("v-row",[n("v-col",[n("CampaignSelector",t._b({attrs:{selectAllCampaigns:!0}},"CampaignSelector",t.campaign_selector,!1,!0))],1),t._v(" "),n("v-col",[n("v-btn",{staticClass:"ma-2 mt-4",attrs:{fab:"",dark:"",small:"",color:"primary",loading:t.loading},on:{click:t.getMarketingCampaigns}},[n("v-icon",[t._v("search")])],1),t._v(" "),n("v-btn",{staticClass:"ma-2 mt-4",attrs:{fab:"",dark:"",small:"",color:"primary",loading:t.downloading},on:{click:t.download}},[n("v-icon",[t._v("cloud_download")])],1)],1)],1),t._v(" "),n("v-row",[n("v-col",{attrs:{cols:"12"}},[n("v-card-text",{staticClass:"mt-4"},[t.marketing_campaigns?n("v-row",[n("v-col",[n("v-data-table",{attrs:{headers:t.columns,items:t.marketing_campaigns,options:t.options,"server-items-length":t.server_total_rows,loading:t.loading,"disable-sort":"","footer-props":{"items-per-page-options":[5,25,50,100,250]}},on:{"update:options":function(e){t.options=e}},scopedSlots:t._u([{key:"item.status",fn:function(t){var e=t.item;return[n("tick-icon",{attrs:{positive:"active"==e.status}})]}},{key:"item.marketingCampaignSchedules",fn:function(t){var e=t.item;return[n("campaign-schedules-chip",{attrs:{display_text:e.marketing_campaign_schedules_count,campaign_uid:e.uid}})]}},{key:"item.uid",fn:function(e){var a=e.item;return[n("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on,i=e.attrs;return[n("v-icon",t._g(t._b({},"v-icon",i,!1),a),[t._v("more_vert\n                                            ")])]}}],null,!0)},[t._v(" "),n("v-list",[n("v-list-item",{on:{click:function(e){return t.toggle_campaign_status(a)}}},[n("v-list-item-title",[t._v("\n                                                    "+t._s("active"==a.status?"Deactivate":"Activate")+"\n                                                ")])],1),t._v(" "),n("v-list-item",{on:{click:function(e){return t.edit_campaign_schedules(a)}}},[n("v-list-item-title",[t._v("Edit")])],1)],1)],1)]}}],null,!1,4255945957)})],1)],1):t._e()],1)],1)],1)],1)],1)}),[],!1,null,"b2aa8048",null);e.default=d.exports},a2bP:function(t,e,n){"use strict";function a(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}var r={name:"CampaignSelector",props:{selectAllCampaigns:{type:Boolean,required:!0},campaign_uid:{required:!0}},data:function(){return{campaigns:[],loading:!1,select_campaign_on_load:null}},methods:{listCampaigns:function(){var t=this;this.loading=!0;var e={fields:["uid","name"],endpoint:"marketing_campaign_names"};graph.getEndPointQuery(e).then((function(e){console.log(e),t.campaigns=a(e),t.selectAllCampaigns&&t.campaigns.unshift({uid:null,name:"All"}),t.loading=!1,t.$route.params.hasOwnProperty("campaign_uid")&&t.$emit("update:campaign_uid",t.$route.params.campaign_uid),t.select_campaign_on_load&&(t.$emit("update:campaign_uid",t.select_campaign_on_load),t.select_campaign_on_load=null)})).catch((function(t){console.log("GET campaigns ERROR:",t)})).finally((function(){}))}},created:function(){var t=this;this.listCampaigns(),this.$bus.on("reload_campaigns_and_select",(function(e){console.log("force reload "+e),t.select_campaign_on_load=e,t.listCampaigns()}))},beforeDestroy:function(){this.$bus.$off("reload_campaigns_and_select")}},o=n("KHd+"),s=Object(o.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",[t.loading?t._e():n("v-select",{attrs:{items:t.campaigns,label:"Select a Campaign","item-text":"name","item-value":"uid",outlined:"",value:t.campaign_uid},on:{input:function(e){return t.$emit("update:campaign_uid",e)}}}),t._v(" "),t.loading?n("v-progress-circular",{attrs:{indeterminate:""}}):t._e()],1)}),[],!1,null,"14a74f8d",null);e.a=s.exports}}]);