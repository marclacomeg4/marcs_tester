(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"4XHU":function(t,e,a){"use strict";var n=a("zNnu"),i=a("DAy3"),s=a("m2Vv"),r=a("OCdX"),o={name:"payment-recurring-status-chip",template:"payment-recurring-status-chip",props:{status:{required:!0}},data:()=>({}),computed:{displayStatus(){return _.upperFirst(this.status)},statusColor(){switch(this.status){case"active":return"green";case"paused":return"red";default:return"grey"}}}},l=a("KHd+"),u=Object(l.a)(o,(function(){var t=this.$createElement;return(this._self._c||t)("v-chip",{attrs:{dark:"",small:"",color:this.statusColor}},[this._v("\n    "+this._s(this.displayStatus)+"\n")])}),[],!1,null,null,null).exports,d=a("HXgr"),c={name:"payment-recurrings-dialog",template:"payment-recurrings-dialog",components:{SagePayAccountChip:r.a,PaymentRecurringStatusChip:u},mixins:[d.a],props:{display_dialog:{required:!0},init_query:{required:!0}},data:function(){return{columns:[{text:"Site Name",value:"affinitySite.site_name"},{text:"Site ID",value:"site_id"},{text:"Reference",value:"affinitySite.bsa"},{text:"Brand",value:"affinitySite.brand"},{text:"Payment Day",value:"day"},{text:"Status",value:"status"},{text:"SagePay Account",value:"vendor"},{text:"Current Balance",value:"affinityBalance.balance"},{text:"Overdue Invoices",value:"affinitySite.overdueBalance.overdue_invoices"},{text:"Created On",value:"created_at"},{text:"SetUp By",value:"user.name"}],default_query:{endpoint:"payment_recurrings",fields:["site_id","day","status","vendor","created_at"],relations:{affinitySite:{fields:["brand","bsa","site_name"],relations:{preferredCardTransaction:{fields:["last_digits","id"]},overdueBalance:{fields:["overdue_invoices"]}}},affinityBalance:{fields:["balance"]},user:{fields:["id","name"]}},order_by:[{field:"CREATED_AT",order:"DESC"}],params:{}},download_setup:{filename:"Recurring Card Payments",columns:null}}}},p={name:"payment-recurrings-total",template:"payment-recurrings-total",components:{PaymentRecurringsDialog:Object(l.a)(c,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-bottom-transition"},model:{value:t.display_dialog,callback:function(e){t.display_dialog=e},expression:"display_dialog"}},[a("v-card",[a("v-toolbar",{attrs:{dark:"",color:"primary"}},[a("v-toolbar-title",[t._v("Recurring Card Agreements")]),t._v(" "),a("v-spacer"),t._v(" "),a("v-toolbar-items",[a("v-btn",{attrs:{fab:"",loading:t.downloading},on:{click:t.download}},[a("v-icon",[t._v("cloud_download")])],1),t._v(" "),a("v-btn",{attrs:{fab:""},on:{click:function(e){return t.$emit("closePaymentRecurringsDrilldown")}}},[a("v-icon",[t._v("close")])],1)],1)],1),t._v(" "),a("v-card-text",{staticClass:"mt-4"},[a("v-row",[a("v-col",[a("v-data-table",{attrs:{headers:t.displayColumns,items:t.rows,options:t.options,"server-items-length":t.server_total_rows,loading:t.loading,"footer-props":{"items-per-page-options":[25,50,100,250]}},on:{"update:options":function(e){t.options=e}},scopedSlots:t._u([{key:"top",fn:function(t){var e=t.pagination,n=t.options,i=t.updateOptions;return[a("v-data-footer",{attrs:{pagination:e,options:n,"items-per-page-options":[25,50,100,250]},on:{"update:options":i}})]}},{key:"item.affinitySite.overdueBalance.overdue_invoices",fn:function(e){var n=e.item;return[n.affinitySite.overdueBalance?a("span",[t._v("\n                        £"+t._s(n.affinitySite.overdueBalance.overdue_invoices.toLocaleString(void 0,{minimumFractionDigits:2}))+"\n                    ")]):t._e()]}},{key:"item.affinityBalance.balance",fn:function(e){var n=e.item;return[n.affinityBalance?a("span",[t._v("\n                       £"+t._s(n.affinityBalance.balance.toLocaleString(void 0,{minimumFractionDigits:2}))+"\n                    ")]):t._e()]}},{key:"item.affinitySite.brand",fn:function(t){var e=t.item;return[a("brand-fab",{attrs:{brand_prefix:e.affinitySite.brand}})]}},{key:"item.vendor",fn:function(t){var e=t.item;return[a("sage-pay-account-chip",{attrs:{vendor_slug:e.vendor}})]}},{key:"item.status",fn:function(t){var e=t.item;return[a("payment-recurring-status-chip",{attrs:{status:e.status}})]}},{key:"item.user.name",fn:function(t){var e=t.item;return[a("user-chip",{attrs:{user_name:e.user.name,user_id:e.user.id}})]}}])})],1)],1)],1)],1)],1)}),[],!1,null,null,null).exports,StatPanel:s.a,StatNumber:n.a},mixins:[i.a],props:{affinity_team_id:{default:null},user_id:{default:null}},data:function(){return{dialog:!1,loading:!1,statistics:{total:0},query:{params:{}}}},methods:{requestDrilldown:function(){this.query.params.created_between=this.$store.getters["date_range/date_range"],this.query.params.affinity_team_id=this.affinity_team_id,this.query.params.user_id=this.user_id?this.user_id:null,this.dialog=!0},getStatistics:function(){var t=this;this.loading=!0;var e={endpoint:"stats_payment_recurrings_total",fields:["stats"],params:{created_between:this.$store.getters["date_range/date_range"],affinity_team_id:this.affinity_team_id,user_id:this.user_id}};this.$graph.getEndPointQuery(e).then((function(e){console.log("Stats Payment Recurrings",e),t.statistics=e.stats})).catch((function(t){console.log(t)})).finally((function(){t.loading=!1}))}},computed:{displaySubTitle:function(){return this.affinity_team_id?"Team: "+affinity_manager.teams_manager().getTeamByID(this.affinity_team_id).team_name:this.user_id?"User ID: "+this.user_id:"All Recurring Setups"}},created:function(){this.getStatistics()}},m=Object(l.a)(p,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("stat-panel",{attrs:{loading:t.loading}},[a("payment-recurrings-dialog",{attrs:{display_dialog:t.dialog,init_query:t.query},on:{closePaymentRecurringsDrilldown:function(e){t.dialog=!1}}}),t._v(" "),a("v-card-title",{staticClass:"pa-0"},[t._v("Recurring Card Agreements")]),t._v(" "),a("v-tooltip",{scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on;e.attrs;return[a("v-card-subtitle",t._g({staticClass:"pa-0"},n),[t._v(t._s(t.displaySubTitle)+"\n            ")])]}}])}),t._v(" "),t.statistics?a("v-row",[a("v-col",{attrs:{cols:"12"}},[a("span",{on:{click:function(e){return t.requestDrilldown()}}},[a("stat-number",{attrs:{number:t.statistics.total.toLocaleString()}})],1)])],1):t._e()],1)}),[],!1,null,null,null);e.a=m.exports},"6FkH":function(t,e,a){"use strict";var n=a("zNnu"),i=a("DAy3"),s=a("m2Vv"),r=a("OCdX"),o=a("HXgr"),l={name:"payment-transactions-dialog",template:"payment-transactions-dialog",components:{SagePayAccountChip:r.a},mixins:[o.a],props:{display_dialog:{required:!0},init_query:{required:!0}},data:function(){return{columns:[{text:"Payment Date",value:"created_at"},{text:"Site Name",value:"affinitySite.site_name"},{text:"Site ID",value:"site_id"},{text:"Reference",value:"affinitySite.bsa"},{text:"Brand",value:"affinitySite.brand"},{text:"SagePay Account",value:"vendor"},{text:"Amount",value:"amount_pounds"},{text:"Bank Auth Code",value:"bank_authorisation_code"},{text:"Card Type",value:"card_type"},{text:"Card Number",value:"last_digits"},{text:"Type",value:"transaction_type"},{text:"Taken By",value:"user.name"}],default_query:{endpoint:"payments",fields:["site_id","amount_pounds","transaction_type","bank_authorisation_code","last_digits","card_type","transaction_type","user_id","vendor","created_at"],relations:{affinitySite:{fields:["brand","bsa","site_name","dealer_id"]},user:{fields:["id","name"]}},order_by:[{field:"CREATED_AT",order:"DESC"}],params:{}},download_setup:{filename:"Payment Transactions Payments",columns:null}}}},u=a("KHd+"),d={name:"payment-transactions-total",template:"payment-transactions-total",components:{PaymentTransactionsDialog:Object(u.a)(l,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-bottom-transition"},model:{value:t.display_dialog,callback:function(e){t.display_dialog=e},expression:"display_dialog"}},[a("v-card",[a("v-toolbar",{attrs:{dark:"",color:"primary"}},[a("v-toolbar-title",[t._v("Payment Transactions")]),t._v(" "),a("v-spacer"),t._v(" "),a("v-toolbar-items",[a("v-btn",{attrs:{fab:"",loading:t.downloading},on:{click:t.download}},[a("v-icon",[t._v("cloud_download")])],1),t._v(" "),a("v-btn",{attrs:{fab:""},on:{click:function(e){return t.$emit("closePaymentTransactionsDrilldown")}}},[a("v-icon",[t._v("close")])],1)],1)],1),t._v(" "),a("v-card-text",{staticClass:"mt-4"},[a("v-row",[a("v-col",[a("v-data-table",{attrs:{headers:t.displayColumns,items:t.rows,options:t.options,"server-items-length":t.server_total_rows,loading:t.loading,"footer-props":{"items-per-page-options":[25,50,100,250]}},on:{"update:options":function(e){t.options=e}},scopedSlots:t._u([{key:"top",fn:function(t){var e=t.pagination,n=t.options,i=t.updateOptions;return[a("v-data-footer",{attrs:{pagination:e,options:n,"items-per-page-options":[25,50,100,250]},on:{"update:options":i}})]}},{key:"item.affinitySite.brand",fn:function(e){var n=e.item;return[n.affinitySite?a("brand-fab",{attrs:{tooltip:"Dealer ID: "+n.affinitySite.dealer_id,brand_prefix:n.affinitySite.brand}}):t._e()]}},{key:"item.vendor",fn:function(t){var e=t.item;return[a("sage-pay-account-chip",{attrs:{vendor_slug:e.vendor}})]}},{key:"item.user.name",fn:function(e){var n=e.item;return[n.user?a("user-chip",{attrs:{user_name:n.user.name,user_id:n.user.id}}):t._e()]}}])})],1)],1)],1)],1)],1)}),[],!1,null,null,null).exports,StatPanel:s.a,StatNumber:n.a},mixins:[i.a],props:{count:{default:!1},transaction_type:{default:null},affinity_team_id:{default:null},user_id:{default:null}},data:function(){return{dialog:!1,loading:!1,statistics:{payment_transactions_amount_pence_sum:0,payment_transactions_count:0},query:{params:{}}}},methods:{requestDrilldown:function(){this.query.params.created_between=this.$store.getters["date_range/date_range"],this.query.params.transaction_type=this.transaction_type?this.transaction_type:null,this.query.params.affinity_team_id=this.affinity_team_id?this.affinity_team_id:null,this.query.params.user_id=this.user_id?this.user_id:null,this.dialog=!0},getStatistics:function(){var t=this;this.loading=!0;var e={endpoint:"stats_payment_transactions_total",fields:["stats"],params:{created_between:this.$store.getters["date_range/date_range"],transaction_type:this.transaction_type,affinity_team_id:this.affinity_team_id,user_id:this.user_id}};this.$graph.getEndPointQuery(e).then((function(e){console.log("Stats Payment Transaction",e),t.statistics=e.stats})).catch((function(t){console.log(t)})).finally((function(){t.loading=!1}))}},computed:{displayNumber:function(){return this.count?this.statistics.payment_transactions_count.toLocaleString():"£"+parseInt(this.statistics.payment_transactions_amount_pence_sum/100).toLocaleString()},displayTitle:function(){return"repeat"===this.transaction_type?"Repeat Payments":"payment"===this.transaction_type?"Single Payments":"Payment Transactions"},displaySubTitle:function(){return this.affinity_team_id?"Team: "+affinity_manager.teams_manager().getTeamByID(this.affinity_team_id).team_name:this.user_id?"User ID: "+this.user_id:"All Successful Payments"}},created:function(){this.getStatistics()}},c=Object(u.a)(d,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("stat-panel",{attrs:{loading:t.loading}},[a("payment-transactions-dialog",{attrs:{display_dialog:t.dialog,init_query:t.query},on:{closePaymentTransactionsDrilldown:function(e){t.dialog=!1}}}),t._v(" "),a("v-card-title",{staticClass:"pa-0"},[t._v(t._s(t.displayTitle))]),t._v(" "),a("v-tooltip",{scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on;e.attrs;return[a("v-card-subtitle",t._g({staticClass:"pa-0"},n),[t._v(t._s(t.displaySubTitle))])]}}])}),t._v(" "),t.statistics?a("v-row",[a("v-col",{attrs:{cols:"12"}},[a("span",{on:{click:function(e){return t.requestDrilldown()}}},[a("stat-number",{attrs:{number:t.displayNumber}})],1)])],1):t._e()],1)}),[],!1,null,null,null);e.a=c.exports},DAy3:function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));var n={watch:{user_id:{handler:function(){this.getStatistics()}},affinity_team_id:{handler:function(){this.getStatistics()}},dateRange:{handler:function(){this.getStatistics()},deep:!0}},computed:{dateRange:{get:function(){return this.$store.getters["date_range/date_range"]},set:function(t){return this.$store.dispatch("date_range/dateRange",t)}}}}},GXJN:function(t,e,a){"use strict";var n={name:"direct-debits-dialog",template:"direct-debits-dialog",mixins:[a("HXgr").a],props:{display_dialog:{required:!0},init_query:{required:!0}},data:function(){return{columns:[{text:"Created",value:"created_at"},{text:"Site ID",value:"site_id"},{text:"Site Name",value:"affinitySite.site_name"},{text:"Brand",value:"affinitySite.brand"},{text:"Account Name",value:"account_holder_name"},{text:"Bank Name",value:"bank_name"},{text:"Bank Address 1",value:"bank_address_1"},{text:"Bank Address 2",value:"bank_address_2"},{text:"Bank Town",value:"bank_town"},{text:"Bank Postcode",value:"bank_postcode"},{text:"Payment Day",value:"payment_day"},{text:"User",value:"user.name"}],default_query:{endpoint:"residential_direct_debits",fields:["created_at","account_holder_name","bank_name","bank_address_1","bank_address_2","bank_town","bank_postcode","payment_day","site_id"],relations:{user:{fields:["name"]},affinitySite:{fields:["site_id","site_name","brand"]}},order_by:[{field:"CREATED_AT",order:"DESC"}],params:{}},download_setup:{filename:"Direct Debits",columns:null}}}},i=a("KHd+"),s=Object(i.a)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-bottom-transition"},model:{value:t.display_dialog,callback:function(e){t.display_dialog=e},expression:"display_dialog"}},[a("v-card",[a("v-toolbar",{attrs:{dark:"",color:"primary"}},[a("v-toolbar-title",[t._v("Direct Debits")]),t._v(" "),a("v-spacer"),t._v(" "),a("v-toolbar-items",[a("v-btn",{attrs:{fab:"",loading:t.downloading},on:{click:t.download}},[a("v-icon",[t._v("cloud_download")])],1),t._v(" "),a("v-btn",{attrs:{fab:""},on:{click:function(e){return t.$emit("closeDirectDebitsDrilldown")}}},[a("v-icon",[t._v("close")])],1)],1)],1),t._v(" "),a("v-card-text",{staticClass:"mt-4"},[a("v-row",[a("v-col",[a("v-data-table",{attrs:{headers:t.displayColumns,items:t.rows,options:t.options,"server-items-length":t.server_total_rows,loading:t.loading,"footer-props":{"items-per-page-options":[25,50,100,250]}},on:{"update:options":function(e){t.options=e}},scopedSlots:t._u([{key:"top",fn:function(t){var e=t.pagination,n=t.options,i=t.updateOptions;return[a("v-data-footer",{attrs:{pagination:e,options:n,"items-per-page-options":[25,50,100,250],"items-per-page-text":"$vuetify.dataTable.itemsPerPageText"},on:{"update:options":i}})]}},{key:"item.affinitySite.brand",fn:function(e){var n=e.item;return[n.affinitySite?a("brand-chip",{attrs:{brand_prefix:n.affinitySite.brand}}):a("span",[t._v("-")])]}},{key:"item.site_id",fn:function(t){var e=t.item;return[a("affinity-site-chip",{attrs:{site_id:e.site_id}})]}}])})],1)],1)],1)],1)],1)}),[],!1,null,null,null);e.a=s.exports},MAmg:function(t,e,a){"use strict";var n=a("+XYa"),i=a("DAy3"),s={name:"payment-transactions-by-hour-chart",template:"payment-transactions-by-hour-chart",components:{StatPanel:a("m2Vv").a,PageLoader:n.a},mixins:[i.a],props:{transaction_type:{default:null},affinity_team_id:{default:null},user_id:{default:null}},data:function(){return{ready:!1,loading:!1,statistics:[]}},methods:{getStatistics:function(){var t=this;this.loading=!0;var e={endpoint:"stats_payment_transactions_by_hour_chart",fields:["stats"],params:{created_between:this.$store.getters["date_range/date_range"],transaction_type:this.transaction_type,affinity_team_id:this.affinity_team_id,user_id:this.user_id}};this.$graph.getEndPointQuery(e).then((function(e){console.log("CDR payments by hour",e),t.statistics=_.toArray(e.stats)})).catch((function(t){console.log(t)})).finally((function(){t.loading=!1,t.ready=!0}))}},computed:{displayTitle:function(){return this.affinity_team_id?"Payment Transactions for Team: "+affinity_manager.teams_manager().getTeamByID(this.affinity_team_id).team_name:this.user_id?"Payment Transactions per Hour for User ID: "+this.user_id:"Payment Transactions per Hour"},computedSeries:function(){return[{name:"Home Telecom",data:this.statistics.map((function(t){return parseInt(t.payments_hometelecom_sum)}))},{name:"Weekly Broadband",data:this.statistics.map((function(t){return parseInt(t.payments_weeklybroadband_sum)}))},{name:"Fleur Broadband",data:this.statistics.map((function(t){return parseInt(t.payments_fleurtelecom_sum)}))},{name:"Perfect Broadband",data:this.statistics.map((function(t){return parseInt(t.payments_perfectbroadband_sum)}))}]},computedChartOptions:function(){return{colors:[COLOR_HT,COLOR_WB,COLOR_FL,COLOR_PB],chart:{type:"bar",stacked:!0},plotOptions:{bar:{horizontal:!1}},dataLabels:{enabled:!1},legend:{position:"top"},tooltip:{enabled:!0,theme:"dark"},xaxis:{categories:this.statistics.map((function(t){return t.hour})),labels:{show:!0,rotate:0}}}}},created:function(){this.getStatistics()}},r=a("KHd+"),o=Object(r.a)(s,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("stat-panel",{attrs:{loading:t.loading}},[a("v-card-title",{staticClass:"pa-0"},[t._v(t._s(t.displayTitle))]),t._v(" "),t.ready?a("apexchart",{attrs:{type:"bar",height:"300",options:t.computedChartOptions,series:t.computedSeries}}):t._e()],1)}),[],!1,null,null,null);e.a=o.exports},OCdX:function(t,e,a){"use strict";var n=a("acYj"),i=a.n(n),s={name:"sage-pay-account-chip",template:"sage-pay-account-chip",props:{vendor_slug:{required:!0}},data:()=>({}),methods:{getBrandAbbreviation(){switch(this.vendor_slug){case"fleurtelecom":return"FL";case"hometelecom":return"HT";case"weeklybroadband":return"WB";case"perfectbroadband":return"PB"}}},computed:{chipColor(){return i.a.getBrand(this.getBrandAbbreviation()).color},displayStatus(){switch(this.vendor_slug){case"fleurtelecom":return"Fleur Telecom";case"hometelecom":return"Home Telecom";case"weeklybroadband":return"Weekly Broadband";case"perfectbroadband":return"Perfect Broadband"}}}},r=a("KHd+"),o=Object(r.a)(s,(function(){var t=this.$createElement;return(this._self._c||t)("v-chip",{attrs:{dark:"",small:"",color:this.chipColor}},[this._v("\n    "+this._s(this.displayStatus)+"\n")])}),[],!1,null,null,null);e.a=o.exports},"RBd+":function(t,e,a){"use strict";var n=a("zNnu"),i=a("DAy3"),s=a("m2Vv"),r={name:"payment-plan-status-chip",template:"payment-plan-status-chip",props:{status:{required:!0}},data:()=>({}),computed:{displayStatus(){return _.upperFirst(this.status)},statusColor(){switch(this.status){case"active":return"green";case"paused":return"red";default:return"grey"}}}},o=a("KHd+"),l=Object(o.a)(r,(function(){var t=this.$createElement;return(this._self._c||t)("v-chip",{attrs:{dark:"",small:"",color:this.statusColor}},[this._v("\n    "+this._s(this.displayStatus)+"\n")])}),[],!1,null,null,null).exports,u={name:"frequency-chip",template:"frequency-chip",props:{frequency:{required:!0}},data:()=>({}),computed:{displayFrequency(){return _.upperFirst(this.frequency)},frequencyColor(){switch(this.frequency){case"monthly":return"green";case"weekly":return"red";default:return"grey"}}}},d={name:"payment-plans-dialog",template:"payment-plans-dialog",components:{FrequencyChip:Object(o.a)(u,(function(){var t=this.$createElement;return(this._self._c||t)("v-chip",{attrs:{dark:"",small:"",color:this.frequencyColor}},[this._v("\n    "+this._s(this.displayFrequency)+"\n")])}),[],!1,null,null,null).exports,PaymentPlanStatusChip:l},mixins:[a("HXgr").a],props:{display_dialog:{required:!0},init_query:{required:!0}},data:function(){return{columns:[{text:"Start Date",value:"start_date"},{text:"Site Name",value:"affinitySite.site_name"},{text:"Site ID",value:"affinitySite.site_id"},{text:"Reference",value:"affinitySite.bsa"},{text:"Brand",value:"affinitySite.brand"},{text:"Initial Amount",value:"initial_amount"},{text:"Recurring Amount",value:"recurring_amount"},{text:"Plan Length",value:"number_of_payments"},{text:"Remaining Payments",value:"remaining_payment_plan_item_count"},{text:"Frequency",value:"frequency"},{text:"Status",value:"status"},{text:"Setup By",value:"user.name"}],default_query:{endpoint:"payment_plans",fields:["start_date","number_of_payments","initial_amount","recurring_amount","frequency","start_date","status","remaining_payment_plan_item_count","site_id"],relations:{affinitySite:{fields:["site_id","site_name","brand","bsa"],relations:{preferredCardTransaction:{fields:["last_digits","id"]}}},finalPaymentPlanItem:{fields:["payment_date"]},user:{fields:["name","id"]}},order_by:[{field:"CREATED_AT",order:"DESC"}],params:{}},download_setup:{filename:"Payment Plans",columns:null}}}},c={name:"payment-plans-total",template:"payment-plans-total",components:{PaymentPlansDialog:Object(o.a)(d,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-bottom-transition"},model:{value:t.display_dialog,callback:function(e){t.display_dialog=e},expression:"display_dialog"}},[a("v-card",[a("v-toolbar",{attrs:{dark:"",color:"primary"}},[a("v-toolbar-title",[t._v("Payment Plans")]),t._v(" "),a("v-spacer"),t._v(" "),a("v-toolbar-items",[a("v-btn",{attrs:{fab:"",loading:t.downloading},on:{click:t.download}},[a("v-icon",[t._v("cloud_download")])],1),t._v(" "),a("v-btn",{attrs:{fab:""},on:{click:function(e){return t.$emit("closePaymentPlansDrilldown")}}},[a("v-icon",[t._v("close")])],1)],1)],1),t._v(" "),a("v-card-text",{staticClass:"mt-4"},[a("v-row",[a("v-col",[a("v-data-table",{attrs:{headers:t.displayColumns,items:t.rows,options:t.options,"server-items-length":t.server_total_rows,loading:t.loading,"footer-props":{"items-per-page-options":[25,50,100,250]}},on:{"update:options":function(e){t.options=e}},scopedSlots:t._u([{key:"top",fn:function(t){var e=t.pagination,n=t.options,i=t.updateOptions;return[a("v-data-footer",{attrs:{pagination:e,options:n,"items-per-page-options":[25,50,100,250]},on:{"update:options":i}})]}},{key:"item.affinitySite.brand",fn:function(t){var e=t.item;return[a("brand-fab",{attrs:{brand_prefix:e.affinitySite.brand}})]}},{key:"item.initial_amount",fn:function(e){var a=e.item;return[t._v("\n                            £"+t._s(a.initial_amount)+"\n                        ")]}},{key:"item.recurring_amount",fn:function(e){var a=e.item;return[t._v("\n                            £"+t._s(a.recurring_amount)+"\n                        ")]}},{key:"item.user.name",fn:function(t){var e=t.item;return[a("user-chip",{attrs:{user_name:e.user.name,user_id:e.user.id}})]}},{key:"item.status",fn:function(t){var e=t.item;return[a("payment-plan-status-chip",{attrs:{status:e.status}})]}},{key:"item.frequency",fn:function(t){var e=t.item;return[a("frequency-chip",{attrs:{frequency:e.frequency}})]}}])})],1)],1)],1)],1)],1)}),[],!1,null,null,null).exports,StatPanel:s.a,StatNumber:n.a},mixins:[i.a],props:{affinity_team_id:{default:null},user_id:{default:null}},data:function(){return{dialog:!1,loading:!1,statistics:{total:0},query:{params:{}}}},methods:{requestDrilldown:function(){this.query.params.created_between=this.$store.getters["date_range/date_range"],this.query.params.affinity_team_id=this.affinity_team_id,this.query.params.user_id=this.user_id?this.user_id:null,this.dialog=!0},getStatistics:function(){var t=this;this.loading=!0;var e={endpoint:"stats_payment_plans_total",fields:["stats"],params:{created_between:this.$store.getters["date_range/date_range"],affinity_team_id:this.affinity_team_id,user_id:this.user_id}};this.$graph.getEndPointQuery(e).then((function(e){console.log("Stats Payment Plans",e),t.statistics=e.stats})).catch((function(t){console.log(t)})).finally((function(){t.loading=!1}))}},computed:{displaySubTitle:function(){return this.affinity_team_id?"Team: "+affinity_manager.teams_manager().getTeamByID(this.affinity_team_id).team_name:this.user_id?"User ID: "+this.user_id:"All Payment Plans"}},created:function(){this.getStatistics()}},p=Object(o.a)(c,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("stat-panel",{attrs:{loading:t.loading}},[a("payment-plans-dialog",{attrs:{display_dialog:t.dialog,init_query:t.query},on:{closePaymentPlansDrilldown:function(e){t.dialog=!1}}}),t._v(" "),a("v-card-title",{staticClass:"pa-0"},[t._v("Payment Plans")]),t._v(" "),a("v-tooltip",{scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on;e.attrs;return[a("v-card-subtitle",t._g({staticClass:"pa-0"},n),[t._v(t._s(t.displaySubTitle))])]}}])}),t._v(" "),t.statistics?a("v-row",[a("v-col",{attrs:{cols:"12"}},[a("span",{on:{click:function(e){return t.requestDrilldown()}}},[a("stat-number",{attrs:{number:t.statistics.total.toLocaleString()}})],1)])],1):t._e()],1)}),[],!1,null,null,null);e.a=p.exports},ikXD:function(t,e,a){"use strict";var n=a("+XYa"),i=a("DAy3"),s={name:"payment-transactions-by-day-chart",template:"payment-transactions-by-day-chart",components:{StatPanel:a("m2Vv").a,PageLoader:n.a},mixins:[i.a],props:{transaction_type:{default:null},affinity_team_id:{default:null},user_id:{default:null}},data:function(){return{ready:!1,loading:!1,statistics:[]}},methods:{getStatistics:function(){var t=this;this.loading=!0;var e={endpoint:"stats_payment_transactions_by_day_chart",fields:["stats"],params:{created_between:this.$store.getters["date_range/date_range"],transaction_type:this.transaction_type,affinity_team_id:this.affinity_team_id,user_id:this.user_id}};this.$graph.getEndPointQuery(e).then((function(e){console.log("CDR payments by day",e),t.statistics=_.toArray(e.stats)})).catch((function(t){console.log(t)})).finally((function(){t.loading=!1,t.ready=!0}))}},computed:{displayTitle:function(){return this.affinity_team_id?"Payment Transactions for Team: "+affinity_manager.teams_manager().getTeamByID(this.affinity_team_id).team_name:this.user_id?"Payment Transactions per Day for User ID: "+this.user_id:"Payment Transactions per Day"},computedSeries:function(){return[{name:"Home Telecom",data:this.statistics.map((function(t){return parseInt(t.payments_hometelecom_sum)}))},{name:"Weekly Broadband",data:this.statistics.map((function(t){return parseInt(t.payments_weeklybroadband_sum)}))},{name:"Fleur Broadband",data:this.statistics.map((function(t){return parseInt(t.payments_fleurtelecom_sum)}))},{name:"Perfect Broadband",data:this.statistics.map((function(t){return parseInt(t.payments_perfectbroadband_sum)}))}]},computedChartOptions:function(){return{colors:[COLOR_HT,COLOR_WB,COLOR_FL,COLOR_PB],chart:{type:"bar",stacked:!0},plotOptions:{bar:{horizontal:!1}},dataLabels:{enabled:!1},legend:{position:"top"},tooltip:{enabled:!0,theme:"dark"},xaxis:{categories:this.statistics.map((function(t){return t.date})),labels:{show:!0,rotate:0}}}}},created:function(){this.getStatistics()}},r=a("KHd+"),o=Object(r.a)(s,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("stat-panel",{attrs:{loading:t.loading}},[a("v-card-title",{staticClass:"pa-0"},[t._v(t._s(t.displayTitle))]),t._v(" "),t.ready?a("apexchart",{attrs:{type:"bar",height:"300",options:t.computedChartOptions,series:t.computedSeries}}):t._e()],1)}),[],!1,null,null,null);e.a=o.exports},ws4E:function(t,e,a){"use strict";var n=a("zNnu"),i=a("DAy3"),s=a("m2Vv"),r={name:"direct-debits-total",template:"direct-debits-total",components:{DirectDebitsDialog:a("GXJN").a,StatPanel:s.a,StatNumber:n.a},mixins:[i.a],props:{affinity_team_id:{default:null},user_id:{default:null}},data:function(){return{dialog:!1,loading:!1,statistics:{total_count:0},query:{params:{}}}},methods:{requestDrilldown:function(t){this.query.params.created_between=this.$store.getters["date_range/date_range"],this.query.params.affinity_team_id=this.affinity_team_id,this.query.params.user_id=this.user_id?this.user_id:null,this.query.params.brand=t||null,this.dialog=!0},getStatistics:function(){var t=this;this.loading=!0;var e={endpoint:"stats_direct_debits_total",fields:["stats"],params:{created_between:this.$store.getters["date_range/date_range"],affinity_team_id:this.affinity_team_id,user_id:this.user_id}};this.$graph.getEndPointQuery(e).then((function(e){console.log("Stats Direct Debits",e),t.statistics=e.stats})).catch((function(t){console.log(t)})).finally((function(){t.loading=!1}))}},computed:{displaySubTitle:function(){return this.affinity_team_id?"Team: "+affinity_manager.teams_manager().getTeamByID(this.affinity_team_id).team_name:this.user_id?"User ID: "+this.user_id:"All Direct Debits"}},created:function(){this.getStatistics()}},o=a("KHd+"),l=Object(o.a)(r,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("stat-panel",{attrs:{loading:t.loading}},[a("direct-debits-dialog",{attrs:{display_dialog:t.dialog,init_query:t.query},on:{closeDirectDebitsDrilldown:function(e){t.dialog=!1}}}),t._v(" "),a("v-card-title",{staticClass:"pa-0"},[t._v("Direct Debits")]),t._v(" "),a("v-tooltip",{scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on;e.attrs;return[a("v-card-subtitle",t._g({staticClass:"pa-0"},n),[t._v(t._s(t.displaySubTitle))])]}}])}),t._v(" "),t.statistics?a("v-row",[a("v-col",{attrs:{cols:"8"}},[a("span",{on:{click:function(e){return t.requestDrilldown()}}},[a("stat-number",{attrs:{number:t.statistics.total_count.toLocaleString()}})],1)]),t._v(" "),a("v-col",{attrs:{cols:"4"}},[a("v-row",[a("v-col",{staticClass:"text-center py-1"},[a("span",{on:{click:function(e){return e.preventDefault(),t.requestDrilldown("HT")}}},[a("brand-chip",{attrs:{brand_prefix:"HT",text:t.statistics.HT_direct_debit_count}})],1)])],1),t._v(" "),a("v-row",[a("v-col",{staticClass:"text-center py-1"},[a("span",{on:{click:function(e){return e.preventDefault(),t.requestDrilldown("FL")}}},[a("brand-chip",{attrs:{brand_prefix:"FL",text:t.statistics.FL_direct_debit_count}})],1)])],1),t._v(" "),a("v-row",[a("v-col",{staticClass:"text-center py-1"},[a("span",{on:{click:function(e){return e.preventDefault(),t.requestDrilldown("WB")}}},[a("brand-chip",{attrs:{brand_prefix:"WB",text:t.statistics.WB_direct_debit_count}})],1)])],1),t._v(" "),a("v-row",[a("v-col",{staticClass:"text-center py-1"},[a("span",{on:{click:function(e){return e.preventDefault(),t.requestDrilldown("PB")}}},[a("brand-chip",{attrs:{brand_prefix:"PB",text:t.statistics.PB_direct_debit_count}})],1)])],1)],1)],1):t._e()],1)}),[],!1,null,null,null);e.a=l.exports}}]);