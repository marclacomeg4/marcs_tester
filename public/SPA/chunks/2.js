(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{Ss75:function(t,e,a){"use strict";var n={name:"ScheduleActionTable.vue",props:["actions","hide_inspect"],data:function(){return{show_dialog:!1,email_content:null}},methods:{show_email_popup:function(t){this.email_content=t.html.replace(/\n/g,""),this.show_dialog=!0},show_inspect_menu:function(t){return!this.hide_inspect&&(console.log(t),!!t.hasOwnProperty("api_result")&&null!==t.api_result)}}},s=a("KHd+"),i=Object(s.a)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("v-dialog",{attrs:{width:"50%"},model:{value:t.show_dialog,callback:function(e){t.show_dialog=e},expression:"show_dialog"}},[a("v-card",[a("v-toolbar-title",{staticClass:"text-right title pl-0"},[a("v-icon",{on:{click:function(e){t.show_dialog=!1}}},[t._v("mdi-close-box")])],1),t._v(" "),a("div",{domProps:{innerHTML:t._s(t.email_content)}})],1)],1),t._v(" "),a("v-simple-table",[a("thead",[a("tr",[a("th",[t._v("Date")]),t._v(" "),a("th",[t._v("Type")]),t._v(" "),a("th",[t._v("Campaign")]),t._v(" "),a("th",[t._v("SMS/Subject")]),t._v(" "),a("th",[t._v("Template")]),t._v(" "),a("th",[t._v("Status")]),t._v(" "),a("th",[t._v("Receipt")]),t._v(" "),a("th",[t._v("Criteria")])])]),t._v(" "),a("tbody",t._l(t.actions,(function(e){return a("tr",{key:e.uid},[a("td",[t._v(t._s(e.action_date))]),t._v(" "),a("td",[t._v(t._s(e.action_type))]),t._v(" "),a("td",[t._v(t._s(e.marketingCampaign.meta.campaign_name))]),t._v(" "),"Email"==e.action_type?a("td",[t._v(t._s(e.meta.email_subject))]):t._e(),t._v(" "),"SMS"==e.action_type?a("td",[t._v(t._s(e.meta.sms))]):t._e(),t._v(" "),"Email"==e.action_type?a("td",[t._v("\n                    "+t._s(e.meta.template)+"\n                ")]):t._e(),t._v(" "),"SMS"==e.action_type?a("td"):t._e(),t._v(" "),a("td",[t._v(t._s(e.status))]),t._v(" "),e.meta_api_result?a("td",[t._v(t._s(e.meta_api_result))]):t._e(),t._v(" "),e.meta_api_result?t._e():a("td"),t._v(" "),a("td",[t._v(t._s(e.telesalesOpportunityCriteria.name))]),t._v(" "),t.show_inspect_menu(e.meta)?a("td",[a("v-menu",{attrs:{"offset-x":""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,s=e.attrs;return[a("v-icon",t._g(t._b({},"v-icon",s,!1),n),[t._v("more_vert\n                            ")])]}}],null,!0)},[t._v(" "),a("v-list",[a("v-list-item",{on:{click:function(a){return t.show_email_popup(e.meta.message)}}},[a("v-list-item-title",[t._v("View")])],1)],1)],1)],1):t._e()])})),0)])],1)}),[],!1,null,"f404355c",null);e.a=i.exports},a2bP:function(t,e,a){"use strict";function n(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return s(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}var i={name:"CampaignSelector",props:{selectAllCampaigns:{type:Boolean,required:!0},campaign_uid:{required:!0}},data:function(){return{campaigns:[],loading:!1,select_campaign_on_load:null}},methods:{listCampaigns:function(){var t=this;this.loading=!0;var e={fields:["uid","name"],endpoint:"marketing_campaign_names"};graph.getEndPointQuery(e).then((function(e){console.log(e),t.campaigns=n(e),t.selectAllCampaigns&&t.campaigns.unshift({uid:null,name:"All"}),t.loading=!1,t.$route.params.hasOwnProperty("campaign_uid")&&t.$emit("update:campaign_uid",t.$route.params.campaign_uid),t.select_campaign_on_load&&(t.$emit("update:campaign_uid",t.select_campaign_on_load),t.select_campaign_on_load=null)})).catch((function(t){console.log("GET campaigns ERROR:",t)})).finally((function(){}))}},created:function(){var t=this;this.listCampaigns(),this.$bus.on("reload_campaigns_and_select",(function(e){console.log("force reload "+e),t.select_campaign_on_load=e,t.listCampaigns()}))},beforeDestroy:function(){this.$bus.$off("reload_campaigns_and_select")}},o=a("KHd+"),r=Object(o.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",[t.loading?t._e():a("v-select",{attrs:{items:t.campaigns,label:"Select a Campaign","item-text":"name","item-value":"uid",outlined:"",value:t.campaign_uid},on:{input:function(e){return t.$emit("update:campaign_uid",e)}}}),t._v(" "),t.loading?a("v-progress-circular",{attrs:{indeterminate:""}}):t._e()],1)}),[],!1,null,"14a74f8d",null);e.a=r.exports},jb2Q:function(t,e,a){"use strict";var n={name:"auto-complete-residential-leads",template:"auto-complete-residential-leads",props:{label:{default:"Residential Leads"},parentDisable:!0},data:function(){return{search:null,model:null,items:[],loading:!1}},methods:{searchResidentialLeads:function(){var t=this;if(this.search.length>2){this.loading=!0;var e={endpoint:"residential_leads",fields:["full_name","uid","email","one_line_address","mobile","status{intended_brand}"],relations:{telesalesOpportunitiesIncomplete:{fields:["id","status"]}},paginate:{first:15,page:1},params:{search:this.search}};this.$graph.getEndPointQuery(e).then((function(e){console.log("Get Auto Residential Leads:",e),t.items=e.data})).catch((function(t){console.log("GET Auto Residential Leads ERROR:",t)})).finally((function(){t.loading=!1}))}}},watch:{model:function(t,e){this.$emit("onLeadSelected",t?t.uid:null)}}},s=a("KHd+"),i=Object(s.a)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-autocomplete",{staticClass:"ma-2",attrs:{"search-input":t.search,loading:t.loading,items:t.items,"item-text":"full_name","item-value":"uid","no-filter":!0,autocomplete:"new-passwords",label:t.label,outlined:"","return-object":"",clearable:"","clear-icon":"close",disabled:t.parentDisable},on:{"update:searchInput":function(e){t.search=e},"update:search-input":function(e){t.search=e},keyup:t.searchResidentialLeads},scopedSlots:t._u([{key:"item",fn:function(e){var n=e.item;e.index;return[a("v-list-item",{on:{click:function(e){t.model=n}}},[a("v-list-item-icon",{staticClass:"ma-1 mt-3"},[a("brand-fab",{attrs:{brand_prefix:n.status.intended_brand}})],1),t._v(" "),a("v-list-item-content",{staticClass:"pa-0"},[a("v-list-item-title",[t._v(t._s(n.full_name))]),t._v(" "),a("v-list-item-subtitle",[t._v(t._s(n.one_line_address))]),t._v(" "),a("v-list-item-subtitle",[t._v(t._s(n.email))]),t._v(" "),a("v-list-item-subtitle",[t._v("Mobile: "+t._s(n.mobile)+" landline: "+t._s(n.landline))])],1)],1)]}}]),model:{value:t.model,callback:function(e){t.model=e},expression:"model"}})}),[],!1,null,null,null);e.a=i.exports},ro3M:function(t,e,a){"use strict";a.r(e);var n=a("wd/R"),s=a.n(n),i={name:"date-range",template:"date-range",components:{},props:{label:{default:"Date Range"},icon:{type:Boolean}},data:()=>({display_range:null,date_range:{to:null,from:null},start_date:null,end_date:null,menu:!1,presets:[{preset:"today",name:"Today"},{preset:"yesterday",name:"Yesterday"},{preset:"last_seven_days",name:"Last Seven Days"},{preset:"this_week",name:"This Week"},{preset:"last_week",name:"Last Week"},{preset:"last_thirty_days",name:"Last Thirty Days"},{preset:"this_month",name:"This Month"},{preset:"last_month",name:"Last Month"}]}),methods:{closeDateRange(){this.$emit("update:dateRangeSelected",this.date_range),this.menu=!1},updateDateRangeFromPreset(t){switch(t){case"today":this.start_date=s()().format("YYYY-MM-DD"),this.end_date=s()().format("YYYY-MM-DD");break;case"yesterday":this.start_date=s()().subtract(1,"days").format("YYYY-MM-DD"),this.end_date=s()().subtract(1,"days").format("YYYY-MM-DD");break;case"last_seven_days":this.start_date=s()().subtract(7,"days").format("YYYY-MM-DD"),this.end_date=s()().format("YYYY-MM-DD");break;case"this_week":this.start_date=s()().startOf("week").format("YYYY-MM-DD"),this.end_date=s()().format("YYYY-MM-DD");break;case"last_week":this.start_date=s()().startOf("week").subtract(7,"days").format("YYYY-MM-DD"),this.end_date=s()().subtract(7,"days").endOf("week").format("YYYY-MM-DD");break;case"last_thirty_days":this.start_date=s()().subtract(30,"days").format("YYYY-MM-DD"),this.end_date=s()().format("YYYY-MM-DD");break;case"this_month":this.start_date=s()().startOf("month").format("YYYY-MM-DD"),this.end_date=s()().format("YYYY-MM-DD");break;case"last_month":this.start_date=s()().startOf("month").subtract(1,"month").format("YYYY-MM-DD"),this.end_date=s()().subtract(1,"month").endOf("month").format("YYYY-MM-DD")}this.closeDateRange()},updateDateRangeFromPastMonth(t,e){this.start_date=t,this.end_date=e,this.closeDateRange()},createDisplayRange(){this.display_range="",this.start_date&&(this.display_range+=this.start_date),this.end_date&&(this.display_range+=" to "+this.end_date)}},watch:{display_range(t,e){_.isNull(t)&&(this.end_date=null,this.start_date=null,this.date_range={to:null,from:null},this.$emit("update:dateRangeSelected",null))},start_date(t,e){this.createDisplayRange(),this.date_range.from=t},end_date(t,e){this.createDisplayRange(),this.date_range.to=t}},computed:{pastMonths(){let t=[];for(let e=1;e<12;e++)t.push({month:s()().startOf("month").subtract(e,"month").format("MMMM YYYY"),start_date:s()().startOf("month").subtract(e,"month").format("YYYY-MM-DD"),end_date:s()().subtract(e,"month").endOf("month").format("YYYY-MM-DD")});return t}}},o=a("KHd+"),r=Object(o.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-menu",{attrs:{"close-on-content-click":!1,"nudge-right":40,transition:"scale-transition","offset-y":"","min-width":"290px"},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,s=e.attrs;return[t.icon?a("v-icon",t._g({},n),[t._v("\n            today\n        ")]):a("v-text-field",t._g(t._b({staticClass:"ma-2",attrs:{autocomplete:"new-password",label:t.label,"clear-icon":"close",outlined:"",clearable:""},model:{value:t.display_range,callback:function(e){t.display_range=e},expression:"display_range"}},"v-text-field",s,!1),n))]}}]),model:{value:t.menu,callback:function(e){t.menu=e},expression:"menu"}},[t._v(" "),a("v-card",[a("v-card-text",[a("v-row",[a("v-col",[a("v-list",[t._l(t.presets,(function(e,n){return a("v-list-item",{key:n,on:{click:function(a){return t.updateDateRangeFromPreset(e.preset)}}},[a("v-list-item-title",{domProps:{textContent:t._s(e.name)}})],1)})),t._v(" "),a("v-menu",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on;e.attrs;return[a("v-list-item",[a("v-list-item-title",t._g({},n),[t._v("Select Month")])],1)]}}])},[t._v(" "),a("v-list",t._l(t.pastMonths,(function(e,n){return a("v-list-item",{key:n,on:{click:function(a){return t.updateDateRangeFromPastMonth(e.start_date,e.end_date)}}},[a("v-list-item-title",[t._v(t._s(e.month))])],1)})),1)],1)],2)],1),t._v(" "),a("v-col",[a("v-date-picker",{model:{value:t.start_date,callback:function(e){t.start_date=e},expression:"start_date"}})],1),t._v(" "),a("v-col",[a("v-date-picker",{on:{input:t.closeDateRange},model:{value:t.end_date,callback:function(e){t.end_date=e},expression:"end_date"}})],1)],1)],1)],1)],1)}),[],!1,null,null,null).exports,l=a("L2JU"),c=a("jb2Q"),d=a("a2bP"),u=a("Ss75");function m(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function p(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?m(Object(a),!0).forEach((function(e){h(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function h(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function v(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return f(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return f(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}var g={name:"CampaignHistory",components:{DateRange:r,AutoCompleteResidentialLeads:c.a,CampaignSelector:d.a,ScheduleActionTable:u.a},data:function(){return{loading:!1,downloading:!1,campaign_history:[],server_total_rows:null,options:{itemsPerPage:10,page:1,order_by:[{field:"ACTION_DATE",order:"ASC"}]},search:{dateRange:{from:"",to:""},show_leads_mode:!1,campaign_uid:null,selected_lead_uid:null,action_status:[]},download_setup:{filename:"Campaign History",columns:this.campaign_history?this.getTableColumns():null},show_leads_mode:!1,action_status:["complete","failed","pending","skipped"],selected_action_status:["complete","failed","pending","skipped"],show_inspect:!1,action_to_inspect:null}},methods:{getTableColumns:function(){var t=[{text:"date",value:"action_date"},{text:"action",value:"action_type"}];return this.search.show_leads_mode&&!this.search.campaign_uid&&(t=[].concat(v(t),[{text:"campaign",value:"marketingCampaign.meta.campaign_name"}])),t=this.search.show_leads_mode?[].concat(v(t),[{text:"name",value:"residentialLead.full_name"},{text:"email",value:"residentialLead.email"},{text:"brand",value:"residentialLead.status.intended_brand"}]):[].concat(v(t),[{text:"total",value:"total"},{text:"complete",value:"complete_count"},{text:"pending",value:"pending_count"},{text:"skipped",value:"skipped_count"},{text:"failed",value:"failed_count"}]),this.search.show_leads_mode&&(t=[].concat(v(t),[{text:"status",value:"status"},{text:"subscribed",value:"residentialLead.json_subscribed"}]),-1!==this.selected_action_status.indexOf("failed")&&(t=[].concat(v(t),[{text:"receipt",value:"meta_api_result"}])),t=[].concat(v(t),[{text:"",value:"uid"}])),t},getRequest:function(){var t={endpoint:"campaign_history",fields:["status","total","action_date","action_type","complete_count","pending_count","failed_count","skipped_count","meta_api_result","meta{api_result, template, email_subject, sms}","residentialLead{full_name, email, uid, json_subscribed, status{unsubscribed, unsubscribed_date, intended_brand}}","marketingCampaign{meta}","telesalesOpportunityCriteria{name}"]},e={};return this.selected_action_status.forEach((function(t){e[t]=!0})),this.search=p(p({},this.search),{},{dateRange:p({},this.dateRange)}),Object.keys(e).length?this.search.action_status=e:delete this.search.action_status,t.params=p({},this.search),t.paginate={first:this.options.itemsPerPage,page:this.options.page},t.relations={},t.order_by=this.options.order_by,t},download:function(){var t=this;this.campaign_history&&(this.downloading=!0,null===this.download_setup.columns&&(this.download_setup.columns=this.getTableColumns().filter((function(t){return t.text.length}))),console.log("setup "+JSON.stringify(this.download_setup)),this.$graph.download(this.getRequest(),this.download_setup).then((function(t){console.log("DOWNLOAD",t)})).finally((function(){t.downloading=!1})))},getCampaignHistory:function(){var t=this;this.show_leads_mode!==this.search.show_leads_mode&&(this.options={itemsPerPage:10,page:1,order_by:[{field:"ACTION_DATE",order:"ASC"}]},this.search.show_leads_mode=this.show_leads_mode),this.loading=!0;var e=this.getRequest();graph.getEndPointQuery(e).then((function(e){console.log("Get campaign history:",e),t.campaign_history=e.data,t.server_total_rows=e.paginatorInfo.total})).catch((function(t){console.log("GET marketing_campaign_search ERROR:",t)})).finally((function(){t.loading=!1}))},changeLeadSelected:function(t){this.search.selected_lead_uid=t},inspect:function(t){this.action_to_inspect=[t],this.show_inspect=!0}},computed:p(p({},Object(l.b)("email",["campaigns"])),{},{campaigns_list:function(){return[{uid:null,campaign_name:"All Campaigns"}].concat(v(this.campaigns))},displayDateRange:function(){var t="";return _.isNull(this.dateRange.from)||(t+=this.$presenter.dateHuman(this.dateRange.from),_.isNull(this.dateRange.to)||(t+=" - "+this.$presenter.dateHuman(this.dateRange.to))),t},dateRange:{get:function(){return this.$store.getters["date_range/date_range"]},set:function(t){return this.$store.dispatch("date_range/dateRange",t)}},isEnabled:function(){return!0}}),watch:{options:{handler:function(){this.getCampaignHistory()}},deep:!0}},b=Object(o.a)(g,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",[a("v-row",[a("v-col",{staticClass:"pt-0"},[a("v-toolbar",{attrs:{dark:"",dense:"",color:"primary"}},[a("v-toolbar-title",[t._v("\n                        Campaign Schedules\n                    ")]),t._v(" "),a("DemoDisplay")],1)],1)],1),t._v(" "),a("v-row",[a("v-col",[a("v-dialog",{attrs:{"max-width":"80%"},model:{value:t.show_inspect,callback:function(e){t.show_inspect=e},expression:"show_inspect"}},[a("v-card",[a("v-toolbar-title",{staticClass:"text-right title pl-0"},[a("v-icon",{on:{click:function(e){t.show_inspect=!1}}},[t._v("mdi-close-box")])],1),t._v(" "),a("ScheduleActionTable",{attrs:{actions:t.action_to_inspect,hide_inspect:!0}})],1)],1)],1),t._v(" "),a("v-col",{attrs:{cols:"3"}},[a("p",[t._v("Select Date Range")]),t._v(" "),a("span",{staticClass:"mx-2"},[t._v(t._s(t.displayDateRange))]),t._v(" "),a("date-range",{attrs:{icon:"",dateRangeSelected:t.dateRange},on:{"update:dateRangeSelected":function(e){t.dateRange=e},"update:date-range-selected":function(e){t.dateRange=e}}})],1),t._v(" "),a("v-col",{attrs:{cols:""}},[a("CampaignSelector",t._b({attrs:{selectAllCampaigns:!0}},"CampaignSelector",t.search,!1,!0))],1),t._v(" "),a("v-col",[a("AutoCompleteResidentialLeads",{attrs:{parentDisable:!t.search.show_leads_mode},on:{onLeadSelected:t.changeLeadSelected}})],1),t._v(" "),a("v-col",[a("v-select",{attrs:{label:"Status",disabled:!t.search.show_leads_mode,multiple:"",items:t.action_status},model:{value:t.selected_action_status,callback:function(e){t.selected_action_status=e},expression:"selected_action_status"}})],1),t._v(" "),a("v-col",{attrs:{cols:""}},[a("v-switch",{attrs:{inset:"",label:"Show Leads"},model:{value:t.show_leads_mode,callback:function(e){t.show_leads_mode=e},expression:"show_leads_mode"}})],1),t._v(" "),a("v-col",[a("v-btn",{staticClass:"ma-2 mt-4",attrs:{fab:"",dark:"",small:"",color:"primary",loading:t.loading},on:{click:t.getCampaignHistory}},[a("v-icon",[t._v("search")])],1),t._v(" "),a("v-btn",{staticClass:"ma-2 mt-4",attrs:{fab:"",dark:"",small:"",color:"primary",loading:t.downloading},on:{click:t.download}},[a("v-icon",[t._v("cloud_download")])],1)],1)],1),t._v(" "),a("v-row",[a("v-col",{attrs:{col:"12"}},[a("v-card-text",{staticClass:"mt-4"},[a("v-row",[a("v-col",[a("v-data-table",{attrs:{headers:t.getTableColumns(),"disable-sort":"",items:t.campaign_history,options:t.options,"server-items-length":t.server_total_rows,loading:t.loading,"footer-props":{"items-per-page-options":[10,25,50,100,250]}},on:{"update:options":function(e){t.options=e}},scopedSlots:t._u([{key:"item.residentialLead.status.intended_brand",fn:function(e){var n=e.item;return[n.residentialLead?a("brand-fab",{attrs:{brand_prefix:n.residentialLead.status.intended_brand}}):t._e()]}},{key:"item.residentialLead.json_subscribed",fn:function(e){var n=e.item;return[n.residentialLead?a("tick-icon",{attrs:{positive:n.residentialLead.json_subscribed}}):t._e()]}},{key:"item.uid",fn:function(e){var n=e.item;return[a("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,s=e.attrs;return[a("v-icon",t._g(t._b({},"v-icon",s,!1),n),[t._v("more_vert\n                                                ")])]}}],null,!0)},[t._v(" "),a("v-list",[a("v-list-item",{on:{click:function(e){return t.inspect(n)}}},[a("v-list-item-title",[t._v("\n                                                        Inspect\n                                                    ")])],1)],1)],1)]}}])})],1)],1)],1)],1)],1)],1)}),[],!1,null,"6cd09026",null);e.default=b.exports}}]);